# vim: syntax=sh

fase_1()
{
    # Do not install recommended packages
    run0 sed -i 's/^#\?Recommends=.*/Recommends=false/' /etc/rpm-ostreed.conf

    # Add Brave Repository
    run0 curl --tlsv1.3 -fsSLo /etc/yum.repos.d/brave-browser.repo https://brave-browser-rpm-release.s3.brave.com/brave-browser.repo

    # Add Mullvad Repository
    run0 curl --tlsv1.3 -fsSLo /etc/yum.repos.d/mullvad.repo https://repository.mullvad.net/rpm/stable/mullvad.repo

    # Install Packages
    rpm-ostree update --install \
        bemenu \
        brave-browser \
        mullvad-vpn \
        neomutt \
        neovim \
        offlineimap \
        wayvnc \
        yubikey-manager \
        zsh

    # Disable Simple Desktop Display Manager
    systemctl disable sddm.service

    # Update GRUB timeout
    echo "set timeout=0" | run0 tee /boot/grub2/user.cfg

    # Fase 1 Done
    echo "fase 1 done" > "${HOME}/chezmoi_install"

    # Reboot
    systemctl reboot
}

fase_2()
{
    # Enable Mullvad VPN
    systemctl enable --now mullvad-daemon.service
    systemctl enable --now mullvad-early-boot-blocking.service

    # Change Shell to ZSH
    chsh --shell=/usr/bin/zsh

    # Add Flathub
    flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo

    # Install Flatpaks
    flatpak install flathub org.keepassxc.KeePassXC
    flatpak install flathub org.libreoffice.LibreOffice
    flatpak install flathub org.qbittorrent.qBittorrent
    flatpak install flathub com.visualstudio.code

    # Fase 2 Done
    echo "fase 2 done" >> "${HOME}/chezmoi_install"
}

if [ ! -f "${HOME}/chezmoi_install" ]; then
    echo "Chezmoi Auto Install: Fase 1"
    #fase_1
else
    echo "Chezmoi Auto Install: Fase 2"
    #fase_2
fi
